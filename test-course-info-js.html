<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Course Info JavaScript Test</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        .success { color: green; }
        .error { color: red; }
        .mock-response { background: #f0f0f0; padding: 10px; margin: 10px 0; }
        button { padding: 10px 15px; margin: 5px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>Course Info JavaScript Test</h1>

    <div class="test-section">
        <h2>Test 1: updateCourseInfo with valid variation</h2>
        <p>This test simulates selecting a course variation and checks if the course info is displayed.</p>

        <!-- Mock HTML structure that would exist on a product page -->
        <div id="intersoccer-course-info" style="display: none; margin: 20px 0; padding: 15px; background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 4px;">
            <h4>Course Information</h4>
            <div id="intersoccer-course-details"></div>
        </div>

        <button onclick="testUpdateCourseInfo()">Test updateCourseInfo</button>
        <div id="test1-result"></div>
    </div>

    <div class="test-section">
        <h2>Test 2: updateCourseInfo with invalid variation</h2>
        <p>This test simulates selecting an invalid variation and checks if course info is hidden.</p>

        <button onclick="testUpdateCourseInfoInvalid()">Test with invalid variation</button>
        <div id="test2-result"></div>
    </div>

    <div class="test-section">
        <h2>Test 3: Manual AJAX Response Simulation</h2>
        <p>This test manually simulates the AJAX response to verify DOM updates.</p>

        <button onclick="testManualAjaxResponse()">Test manual AJAX response</button>
        <div id="test3-result"></div>
    </div>

    <!-- Mock intersoccerCheckout object -->
    <script>
        window.intersoccerCheckout = {
            ajax_url: '/wp-admin/admin-ajax.php',
            nonce: 'test_nonce_123'
        };
    </script>

    <!-- Include the variation-details.js file -->
    <script src="js/variation-details.js"></script>

    <script>
        // Mock jQuery AJAX for testing
        let originalAjax = $.ajax;
        let mockAjaxResponses = {};
        let ajaxCallLog = [];

        $.ajax = function(options) {
            ajaxCallLog.push({
                url: options.url,
                type: options.type,
                data: options.data
            });

            console.log('Mock AJAX call:', options);

            // Check if we have a mock response
            let key = options.data.action + '_' + options.data.variation_id;
            if (mockAjaxResponses[key]) {
                setTimeout(() => {
                    options.success(mockAjaxResponses[key]);
                }, 100);
                return {
                    done: function() {},
                    fail: function() {},
                    always: function() {}
                };
            }

            // Default mock response
            setTimeout(() => {
                options.success({
                    success: true,
                    data: {
                        html: '<p><strong>Start Date:</strong> December 1, 2025</p><p><strong>Total Sessions:</strong> 10</p><p><strong>Remaining Sessions:</strong> 5</p>'
                    }
                });
            }, 100);

            return {
                done: function() {},
                fail: function() {},
                always: function() {}
            };
        };

        function testUpdateCourseInfo() {
            // Reset
            ajaxCallLog = [];
            $('#intersoccer-course-details').empty();
            $('#intersoccer-course-info').hide();

            // Call the function (assuming it's in global scope from variation-details.js)
            if (typeof updateCourseInfo === 'function') {
                updateCourseInfo(123, 456);

                setTimeout(() => {
                    let result = $('#test1-result');
                    let courseInfoVisible = $('#intersoccer-course-info').is(':visible');
                    let courseDetailsHtml = $('#intersoccer-course-details').html();

                    result.html(`
                        <div class="${courseInfoVisible ? 'success' : 'error'}">
                            Course info visible: ${courseInfoVisible}<br>
                            Course details HTML: ${courseDetailsHtml ? 'Present' : 'Empty'}<br>
                            AJAX calls made: ${ajaxCallLog.length}
                        </div>
                        <div class="mock-response">
                            <strong>AJAX Call Details:</strong><br>
                            ${JSON.stringify(ajaxCallLog[0], null, 2)}
                        </div>
                    `);
                }, 200);
            } else {
                $('#test1-result').html('<div class="error">updateCourseInfo function not found</div>');
            }
        }

        function testUpdateCourseInfoInvalid() {
            // Reset
            ajaxCallLog = [];
            $('#intersoccer-course-details').empty();
            $('#intersoccer-course-info').show(); // Start visible

            // Call with invalid variation
            if (typeof updateCourseInfo === 'function') {
                updateCourseInfo(123, 0); // Invalid variation ID

                setTimeout(() => {
                    let result = $('#test2-result');
                    let courseInfoVisible = $('#intersoccer-course-info').is(':visible');

                    result.html(`
                        <div class="${!courseInfoVisible ? 'success' : 'error'}">
                            Course info hidden: ${!courseInfoVisible}<br>
                            AJAX calls made: ${ajaxCallLog.length}
                        </div>
                    `);
                }, 200);
            } else {
                $('#test2-result').html('<div class="error">updateCourseInfo function not found</div>');
            }
        }

        function testManualAjaxResponse() {
            // Manually test the DOM update logic
            $('#intersoccer-course-details').empty();
            $('#intersoccer-course-info').hide();

            // Simulate successful AJAX response
            let mockResponse = {
                success: true,
                data: {
                    html: '<p><strong>Start Date:</strong> December 1, 2025</p><p><strong>Total Sessions:</strong> 10</p><p><strong>Remaining Sessions:</strong> 5</p>'
                }
            };

            // Simulate the success callback from updateCourseInfo
            $('#intersoccer-course-details').html(mockResponse.data.html);
            $('#intersoccer-course-info').show();

            let result = $('#test3-result');
            let courseInfoVisible = $('#intersoccer-course-info').is(':visible');
            let courseDetailsHtml = $('#intersoccer-course-details').html();

            result.html(`
                <div class="${courseInfoVisible ? 'success' : 'error'}">
                    Course info visible: ${courseInfoVisible}<br>
                    Course details contains expected content: ${courseDetailsHtml.includes('Start Date')}<br>
                    HTML content: ${courseDetailsHtml.substring(0, 100)}...
                </div>
            `);
        }

        // Check if the function is available when page loads
        $(document).ready(function() {
            if (typeof updateCourseInfo === 'function') {
                console.log('updateCourseInfo function is available');
            } else {
                console.error('updateCourseInfo function not found');
            }
        });
    </script>
</body>
</html>